

    {{!-- <title>Google Maps Multiple Markers</title> --}}
    {{!-- <script src="http://maps.google.com/maps/api/js?sensor=false" type="text/javascript"></script> --}}

    {{!-- STEPS TO DO --}}
    {{!-- 1. Display the user location on the map onload with a marker--}}
    {{!-- 2. Display the services on that category on the map with markers --}}
    {{!-- **************************************************************************** --}}


        <style>
            /* Always set the map height explicitly to define the size of the div
           * element that contains the map. */
    

    
            /* Optional: Makes the sample page fill the window. */
    
            html,
            body,
            #map {
              width: 100%;
              height: 100%;
            }

    
            .controls {
                background-color: #fff;
                border-radius: 2px;
                border: 1px solid transparent;
                box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
                box-sizing: border-box;
                font-family: Roboto;
                font-size: 15px;
                font-weight: 300;
                height: 29px;
                margin-left: 17px;
                margin-top: 10px;
                outline: none;
                padding: 0 11px 0 13px;
                text-overflow: ellipsis;
                width: 400px;
            }
    
            .controls:focus {
                border-color: #4d90fe;
            }
    
            .title {
                font-weight: bold;
            }
    
            #infowindow-content {
                display: none;
            }
    
            #googleMap #infowindow-content {
                display: inline;
            }
        </style>

     {{#each workers}}
        {{!-- THIS IS THE TEMPLATE WE DISPLAY ON THE MAPS PAGE --}}
        {{!-- <input id="pac-input" class="controls" type="text" placeholder="Enter a location"> --}}
    
        <div id="googleMap" style="width:100%;height:100%;bottom:0%">
            <span id="zipCode">{{this.dataValues.zip_code}}</span>
            <br>
            <span id="place-address"></span>
        </div>

        {{!-- FRONT END JS CODE --}}
     {{/each}}
        
    
        
        
        <script>
         
            var myLatLng_;
            var latit;
            var longit;
            function geoSuccess(position) {
                
                var latitude = position.coords.latitude;
                var longitude = position.coords.longitude;
                var directionsService = new google.maps.DirectionsService;
                var directionsDisplay = new google.maps.DirectionsRenderer;
                myLatLng_ = {
                    lat: latitude,
                    lng: longitude
                };
                var mapProp = {
                    //center: new google.maps.LatLng(latitude, longitude), // puts your current location at the centre of the map,
                    zoom: 15,
                    mapTypeId: 'roadmap',
                };
                var map = new google.maps.Map(document.getElementById("googleMap"), mapProp);
                var directionsService = new google.maps.DirectionsService;
                var directionsDisplay = new google.maps.DirectionsRenderer;
                //call renderer to display directions
                directionsDisplay.setMap(map);
                var bounds = new google.maps.LatLngBounds();
                //        var mapOptions = {
                //            mapTypeId: 'roadmap'
                //        };
                // Multiple Markers
                var marker = new google.maps.Marker({
                    position: myLatLng_,
                    map: map,
                    title: 'My location'
                });
                //AJAX CALL TO DATABASE
                var zipCode = document.getElementById('zipCode').textContent;
                console.log(zipCode);
                // Here we are building the URL we need to query the database
                var queryURL = "https://maps.googleapis.com/maps/api/geocode/json?components=postal_code:" + zipCode + "&key=AIzaSyBx4l2x84Yqb7HqvmtgywSwQJJwEPN_ehk";
                // Here we run our AJAX call to the API
                $.ajax({
                    url: queryURL,
                    method: "GET"
                })
                .done(function (response) {
                        // Log the queryURL
                        console.log(queryURL);
                        console.log(response);
                        // Log the resulting object
                        var geometryLocation = response.results[0].geometry.location;
                        var latLong_gels = [];
                        latLong_gels.push(geometryLocation);
                       
                        // Transfer content to HTML
                        //**************** TRYING TO INSERT LANG AND LONG TO LOCATE USER ZIPCODE ON THE MAP DYNAMICALLY WITH MARKER
                        var lat_ = latLong_gels[0].lat;
                        var long_ = latLong_gels[0].lng;

                    var markers = [

                        ['workers location', lat_, long_],
                        ['my current location', latitude, longitude]
                    ];
               

                // Display multiple markers on a map
                var infoWindow = new google.maps.InfoWindow(),
                    marker, i;
                // Loop through our array of markers & place each one on the map
                    for (i = 0; i < markers.length; i++) {
                        var position = new google.maps.LatLng(markers[i][1], markers[i][2]);
                        bounds.extend(position);
                        marker = new google.maps.Marker({
                            position: position,
                            map: map,
                            title: markers[i][0]
                        });
                        // Automatically center the map fitting all markers on the screen
                        map.fitBounds(bounds);
                    }

                });

        }
            

            function geoError() {
                alert("Geocoder failed.");
            }
            function getLocation() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(geoSuccess, geoError);
                    // alert("Geolocation is supported by this browser.");
                } else {
                    alert("Geolocation is not supported by this browser.");
                }
            }
        </script>
       